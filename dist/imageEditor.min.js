"use strict";var ImageEditor;ImageEditor=function(){function n(n){var t,e;null==n&&(n={}),n.elt&&(e=this,e.config=n,e.formats=["image/jpg","image/jpeg","image/png","image/gif"],t=e.config.elt,e.reader=new FileReader,e.input=e.config.input||t.querySelector("input[type=file]"),e.canvas=e.config.canvas||t.querySelector("canvas"),e.btLeft=e.config.btLeft||t.querySelector(".bt-left"),e.btRight=e.config.btRight||t.querySelector(".bt-right"),e.btLess=e.config.btLess||t.querySelector(".bt-less"),e.btMore=e.config.btMore||t.querySelector(".bt-more"),e.btSave=e.config.btSave||t.querySelector(".bt-save"),e.doc=document,e.context=e.canvas.getContext("2d"),e.cnvW=e.canvas.width,e.cnvH=e.canvas.height,e.cnvRatio=e.canvas.height/e.canvas.width,e.cnvHalfW=e.cnvW/2,e.cnvHalfH=e.cnvH/2,e.cnvClearPx=-e.cnvW,e.cnvClearPy=-e.cnvH,e.cnvClearW=2*e.cnvW,e.cnvClearH=2*e.cnvH,e.toRad=Math.PI/180,e.zoom=e.config.zoom?e.config.zoom<=1?1.1:e.config.zoom>2?2:e.config.zoom:1.1,e.maxZoom=e.config.maxZoom?e.config.maxZoom<1?1:e.config.maxZoom>25?25:e.config.maxZoom:20,e.maxSize=e.config.maxSize?e.config.maxSize<1?1:e.config.maxSize>15?15:e.config.maxSize:5,e.maxSize=1e6*e.maxSize,e.reader.onload=function(n){return e.update(n.target.result)},e.reader.onabort=function(n){return e.config.callbackOnAbort?e.config.callbackOnAbort(n.target.error.message):void 0},e.reader.onerror=function(n){return e.config.callbackOnError?e.config.callbackOnError(n.target.error.message):void 0},e.reader.onloadstart=function(){return e.config.callbackOnLoadStart?e.config.callbackOnLoadStart():void 0},e.reader.onprogress=function(n){return e.config.callbackOnProgress?e.config.callbackOnProgress(n.loaded/n.total*100):void 0},e.reader.onloadend=function(n){return e.config.callbackOnLoadEnd?e.config.callbackOnLoadEnd():void 0},e.input.addEventListener("change",function(n){var t;if(n.target.files[0])return t=n.target.files[0],t.size>e.maxSize?void(e.config.callbackOnOverSize&&e.config.callbackOnOverSize(t.size,e.maxSize)):e.reader.readAsDataURL(t)}))}return n.prototype.checkFormat=function(n){var t,e,a,o,i,r;for(r=this,e=!1,i=r.formats,a=0,o=i.length;o>a;a++)if(t=i[a],~n.indexOf(t)){e=!0;break}return e},n.prototype.init=function(){var n;return n=this,n.btLeft.addEventListener("click",n.turnLeft.bind(n),!1),n.btRight.addEventListener("click",n.turnRight.bind(n),!1),n.btLess.addEventListener("click",n.zoomOut.bind(n),!1),n.btMore.addEventListener("click",n.zoomIn.bind(n),!1),n.btSave.addEventListener("click",n.saveImage.bind(n),!1),n.canvas.addEventListener("wheel",n.wheel.bind(n),!1),n.canvas.addEventListener("mousedown",n.dragStart.bind(n),!1),n.context.translate(n.cnvHalfW,n.cnvHalfH),n.context.save(),n.drawImage(),n.initialized=!0,n.config.callbackOnInit?n.config.callbackOnInit():void 0},n.prototype.update=function(n){var t;return t=this,t.checkFormat(n)?(t.createImg(n),t.context.rotate(t.toRad*-(t.currentAngle||0)),t.currentAngle=0,t.newAngle=0,t.currentZoom=1,t.imgSettings(),t.initialized?(t.context.restore(),t.drawImage(),t.config.callbackOnUpdate?t.config.callbackOnUpdate():void 0):void(t.picture.onload=function(){return t.init()})):void(t.config.callbackOnWrongFormat&&t.config.callbackOnWrongFormat(n,t.formats))},n.prototype.createImg=function(n){var t;return t=this,t.picture=new Image,t.picture.setAttribute("crossOrigin","anonymous"),t.picture.src=n},n.prototype.imgSettings=function(){var n,t;return t=this,t.picRatio=t.picture.height/t.picture.width,n=t.picRatio<1,t.imgW=n?t.cnvW/t.picRatio:t.cnvW,t.imgH=n?t.cnvH:t.cnvH*t.picRatio,t.imgPx=-t.imgW/2,t.imgPy=-t.imgH/2},n.prototype.wheel=function(n){var t;return t=this,n.deltaY>0?t.zoomOut.bind(t)():n.deltaY<0?t.zoomIn.bind(t)():void 0},n.prototype.turnLeft=function(){var n;return n=this,n.animation&&clearInterval(n.animation),n.newAngle-=90,n.rotation(),n.config.callbackOnTurnLeft?n.config.callbackOnTurnLeft(n.newAngle):void 0},n.prototype.turnRight=function(){var n;return n=this,n.animation&&clearInterval(n.animation),n.newAngle+=90,n.rotation(),n.config.callbackOnTurnRight?n.config.callbackOnTurnRight(n.newAngle):void 0},n.prototype.zoomOut=function(){var n;return n=this,n.currentZoom<=1?void 0:(n.imgW/=n.zoom,n.imgH/=n.zoom,n.currentZoom--,n.drawImage(),n.config.callbackOnZoomOut?n.config.callbackOnZoomOut(n.currentZoom):void 0)},n.prototype.zoomIn=function(){var n;return n=this,n.currentZoom>n.maxZoom?void 0:(n.imgW*=n.zoom,n.imgH*=n.zoom,n.currentZoom++,n.drawImage(),n.config.callbackOnZoomIn?n.config.callbackOnZoomIn(n.currentZoom):void 0)},n.prototype.dragStart=function(n){var t;return t=this,n.preventDefault(),t.direction=(t.newAngle%360+360)%360,t.xVal=n.clientX,t.yVal=n.clientY,t.dragMoveContext=function(n){return t.dragMove(n)},t.dragStopContext=function(n){return t.dragStop(n)},t.canvas.addEventListener("mousemove",t.dragMoveContext,!1),t.doc.addEventListener("mouseup",t.dragStopContext,!1),t.config.callbackOnDragStart?t.config.callbackOnDragStart(t.xVal,t.yVal):void 0},n.prototype.dragMove=function(n){var t;switch(t=this,t.direction){case 0:t.imgPx=t.imgPx+=n.clientX-t.xVal,t.imgPy=t.imgPy+=n.clientY-t.yVal;break;case 90:t.imgPx=t.imgPx+=n.clientY-t.yVal,t.imgPy=t.imgPy-=n.clientX-t.xVal;break;case 180:t.imgPx=t.imgPx-=n.clientX-t.xVal,t.imgPy=t.imgPy-=n.clientY-t.yVal;break;case 270:t.imgPx=t.imgPx-=n.clientY-t.yVal,t.imgPy=t.imgPy+=n.clientX-t.xVal}return t.drawImage(),t.xVal=n.clientX,t.yVal=n.clientY,t.config.callbackOnDragMove?t.config.callbackOnDragMove(t.xVal,t.yVal):void 0},n.prototype.dragStop=function(){var n;return n=this,n.canvas.removeEventListener("mousemove",n.dragMoveContext,!1),n.doc.removeEventListener("mouseup",n.dragStopContext,!1),n.config.callbackOnDragStop?n.config.callbackOnDragStop(n.xVal,n.yVal):void 0},n.prototype.rotation=function(){var n,t;return t=this,t.animating=!0,n=t.currentAngle<t.newAngle,t.animation=setInterval(function(){return n?t.currentAngle+=2:t.currentAngle-=2,t.context.rotate(2*(n?t.toRad:-t.toRad)),t.drawImage(),t.currentAngle===t.newAngle?(clearInterval(t.animation),t.animating=!1):void 0},1)},n.prototype.dataURItoBlob=function(n){var t,e,a,o;for(t=-1!==n.split(",")[0].indexOf("base64")?atob(n.split(",")[1]):decodeURI(n.split(",")[1]),o=n.split(",")[0].split(":")[1].split(";")[0],e=new Array,a=0;a<t.length;)e[a]=t.charCodeAt(a),a++;return new Blob([new Uint8Array(e)],{type:"image/jpeg"})},n.prototype.drawImage=function(){var n;return n=this,n.context.clearRect(n.cnvClearPx,n.cnvClearPy,n.cnvClearW,n.cnvClearH),n.imgPx>=-n.cnvHalfW?n.imgPx=-n.cnvHalfW:n.imgPx<=n.cnvHalfW-n.imgW&&(n.imgPx=n.cnvHalfW-n.imgW),n.imgPy>=-n.cnvHalfH?n.imgPy=-n.cnvHalfH:n.imgPy<=n.cnvHalfH-n.imgH&&(n.imgPy=n.cnvHalfH-n.imgH),n.context.drawImage(n.picture,n.imgPx,n.imgPy,n.imgW,n.imgH)},n.prototype.saveImage=function(){var n,t;return t=this,t.animating?void 0:(n=t.canvas.toDataURL(),t.config.callbackOnSave?t.config.callbackOnSave({base64:n,blob:t.dataURItoBlob(n)}):void 0)},n}();