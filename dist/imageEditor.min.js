"use strict";var ImageEditor;ImageEditor=function(){function t(t){var e,n;null==t&&(t={}),(t.elt||t.pic)&&(n=this,n.config=t,e=n.config.elt,n.canvas=e.querySelector("canvas"),n.btLeft=e.querySelector(".bt-left"),n.btRight=e.querySelector(".bt-right"),n.btLess=e.querySelector(".bt-less"),n.btMore=e.querySelector(".bt-more"),n.btSave=e.querySelector(".bt-save"),n.doc=document,n.context=n.canvas.getContext("2d"),n.cnvW=n.canvas.width,n.cnvH=n.canvas.height,n.cnvRatio=n.canvas.height/n.canvas.width,n.cnvHalfW=n.cnvW/2,n.cnvHalfH=n.cnvH/2,n.cnvClearPx=-n.cnvW,n.cnvClearPy=-n.cnvH,n.cnvClearW=2*n.cnvW,n.cnvClearH=2*n.cnvH,n.currentAngle=0,n.newAngle=0,n.toRad=Math.PI/180,n.zoom=1.1,n.currentZoom=1,n.maxZoom=20,n.picture=new Image,n.picture.setAttribute("crossOrigin","anonymous"),n.picture.src=n.config.pic,n.picture.onload=function(){return n.init()})}return t.prototype.init=function(){var t;return t=this,t.btLeft.addEventListener("click",t.turnLeft.bind(t),!1),t.btRight.addEventListener("click",t.turnRight.bind(t),!1),t.btLess.addEventListener("click",t.zoomOut.bind(t),!1),t.btMore.addEventListener("click",t.zoomIn.bind(t),!1),t.btSave.addEventListener("click",t.saveImage.bind(t),!1),t.canvas.addEventListener("mousedown",t.dragStart.bind(t),!1),t.doc.addEventListener("mouseup",t.dragStop.bind(t),!1),t.imgSettings(),t.context.translate(t.cnvHalfW,t.cnvHalfH),t.context.save(),t.drawImage(),t.initialized=!0},t.prototype.update=function(t){var e;return e=this,e.context.rotate(e.toRad*-e.currentAngle),e.currentAngle=0,e.newAngle=0,e.currentZoom=1,e.picture=new Image,e.picture.setAttribute("crossOrigin","anonymous"),e.picture.src=t,e.imgSettings(),e.context.restore(),e.drawImage()},t.prototype.imgSettings=function(){var t,e;return e=this,e.picRatio=e.picture.height/e.picture.width,t=e.picRatio<1,e.imgW=t?e.cnvW/e.picRatio:e.cnvW,e.imgH=t?e.cnvH:e.cnvH*e.picRatio,e.imgPx=-e.imgW/2,e.imgPy=-e.imgH/2},t.prototype.turnLeft=function(){var t;return t=this,t.animation&&clearInterval(t.animation),t.newAngle-=90,t.rotation()},t.prototype.turnRight=function(){var t;return t=this,t.animation&&clearInterval(t.animation),t.newAngle+=90,t.rotation()},t.prototype.zoomOut=function(){var t;return t=this,t.currentZoom<=1?void 0:(t.imgW/=t.zoom,t.imgH/=t.zoom,t.currentZoom--,t.drawImage())},t.prototype.zoomIn=function(){var t;return t=this,t.currentZoom>t.maxZoom?void 0:(t.imgW*=t.zoom,t.imgH*=t.zoom,t.currentZoom++,t.drawImage())},t.prototype.dragStart=function(t){var e;return e=this,t.preventDefault(),e.direction=(e.newAngle%360+360)%360,e.xVal=t.clientX,e.yVal=t.clientY,e.dragMoveContext=function(t){return e.dragMove(t)},e.canvas.addEventListener("mousemove",e.dragMoveContext,!1)},t.prototype.dragMove=function(t){var e;switch(e=this,e.direction){case 0:e.imgPx=e.imgPx+=t.clientX-e.xVal,e.imgPy=e.imgPy+=t.clientY-e.yVal;break;case 90:e.imgPx=e.imgPx+=t.clientY-e.yVal,e.imgPy=e.imgPy-=t.clientX-e.xVal;break;case 180:e.imgPx=e.imgPx-=t.clientX-e.xVal,e.imgPy=e.imgPy-=t.clientY-e.yVal;break;case 270:e.imgPx=e.imgPx-=t.clientY-e.yVal,e.imgPy=e.imgPy+=t.clientX-e.xVal}return e.drawImage(),e.xVal=t.clientX,e.yVal=t.clientY},t.prototype.dragStop=function(){var t;return t=this,t.canvas.removeEventListener("mousemove",t.dragMoveContext,!1)},t.prototype.rotation=function(){var t,e;return e=this,e.animating=!0,t=e.currentAngle<e.newAngle,e.animation=setInterval(function(){return t?e.currentAngle+=2:e.currentAngle-=2,e.context.rotate(2*(t?e.toRad:-e.toRad)),e.drawImage(),e.currentAngle===e.newAngle?(clearInterval(e.animation),e.animating=!1):void 0},1)},t.prototype.drawImage=function(){var t;return t=this,t.context.clearRect(t.cnvClearPx,t.cnvClearPy,t.cnvClearW,t.cnvClearH),t.imgPx>=-t.cnvHalfW?t.imgPx=-t.cnvHalfW:t.imgPx<=t.cnvHalfW-t.imgW&&(t.imgPx=t.cnvHalfW-t.imgW),t.imgPy>=-t.cnvHalfH?t.imgPy=-t.cnvHalfH:t.imgPy<=t.cnvHalfH-t.imgH&&(t.imgPy=t.cnvHalfH-t.imgH),t.context.drawImage(t.picture,t.imgPx,t.imgPy,t.imgW,t.imgH)},t.prototype.saveImage=function(){var t,e;return e=this,e.animating?void 0:(t=e.canvas.toDataURL(),e.config.callbackOnSave?e.config.callbackOnSave(t):void 0)},t}();