"use strict";var ImageEditor;ImageEditor=function(){function t(t){var n,e;null==t&&(t={}),t.elt&&(e=this,e.config=t,e.formats=["image/jpg","image/jpeg","image/png","image/gif"],n=e.config.elt,e.reader=new FileReader,e.input=e.config.input||n.querySelector("input[type=file]"),e.canvas=e.config.canvas||n.querySelector("canvas"),e.btLeft=e.config.btLeft||n.querySelector(".bt-left"),e.btRight=e.config.btRight||n.querySelector(".bt-right"),e.btLess=e.config.btLess||n.querySelector(".bt-less"),e.btMore=e.config.btMore||n.querySelector(".bt-more"),e.btSave=e.config.btSave||n.querySelector(".bt-save"),e.doc=document,e.context=e.canvas.getContext("2d"),e.cnvW=e.canvas.width,e.cnvH=e.canvas.height,e.cnvRatio=e.canvas.height/e.canvas.width,e.cnvHalfW=e.cnvW/2,e.cnvHalfH=e.cnvH/2,e.cnvClearPx=-e.cnvW,e.cnvClearPy=-e.cnvH,e.cnvClearW=2*e.cnvW,e.cnvClearH=2*e.cnvH,e.toRad=Math.PI/180,e.zoom=1.1,e.maxZoom=20,e.reader.onload=function(t){return e.update(t.target.result)},e.input.addEventListener("change",function(t){return e.reader.readAsDataURL(t.target.files[0])}))}return t.prototype.checkFormat=function(t){var n,e,a,i,o,r;for(r=this,e=!1,o=r.formats,a=0,i=o.length;i>a;a++)if(n=o[a],~t.indexOf(n)){e=!0;break}return e},t.prototype.init=function(){var t;return t=this,t.btLeft.addEventListener("click",t.turnLeft.bind(t),!1),t.btRight.addEventListener("click",t.turnRight.bind(t),!1),t.btLess.addEventListener("click",t.zoomOut.bind(t),!1),t.btMore.addEventListener("click",t.zoomIn.bind(t),!1),t.btSave.addEventListener("click",t.saveImage.bind(t),!1),t.canvas.addEventListener("mousedown",t.dragStart.bind(t),!1),t.context.translate(t.cnvHalfW,t.cnvHalfH),t.context.save(),t.drawImage(),t.initialized=!0,t.config.callbackOnInit?t.config.callbackOnInit():void 0},t.prototype.update=function(t){var n;return n=this,n.checkFormat(t)?(n.createImg(t),n.context.rotate(n.toRad*-(n.currentAngle||0)),n.currentAngle=0,n.newAngle=0,n.currentZoom=1,n.imgSettings(),n.initialized?(n.context.restore(),n.drawImage(),n.config.callbackOnUpdate?n.config.callbackOnUpdate():void 0):void(n.picture.onload=function(){return n.init()})):void 0},t.prototype.createImg=function(t){var n;return n=this,n.picture=new Image,n.picture.setAttribute("crossOrigin","anonymous"),n.picture.src=t},t.prototype.imgSettings=function(){var t,n;return n=this,n.picRatio=n.picture.height/n.picture.width,t=n.picRatio<1,n.imgW=t?n.cnvW/n.picRatio:n.cnvW,n.imgH=t?n.cnvH:n.cnvH*n.picRatio,n.imgPx=-n.imgW/2,n.imgPy=-n.imgH/2},t.prototype.turnLeft=function(){var t;return t=this,t.animation&&clearInterval(t.animation),t.newAngle-=90,t.rotation(),t.config.callbackOnTurnLeft?t.config.callbackOnTurnLeft(t.newAngle):void 0},t.prototype.turnRight=function(){var t;return t=this,t.animation&&clearInterval(t.animation),t.newAngle+=90,t.rotation(),t.config.callbackOnTurnRight?t.config.callbackOnTurnRight(t.newAngle):void 0},t.prototype.zoomOut=function(){var t;return t=this,t.currentZoom<=1?void 0:(t.imgW/=t.zoom,t.imgH/=t.zoom,t.currentZoom--,t.drawImage(),t.config.callbackOnZoomOut?t.config.callbackOnZoomOut(t.currentZoom):void 0)},t.prototype.zoomIn=function(){var t;return t=this,t.currentZoom>t.maxZoom?void 0:(t.imgW*=t.zoom,t.imgH*=t.zoom,t.currentZoom++,t.drawImage(),t.config.callbackOnZoomIn?t.config.callbackOnZoomIn(t.currentZoom):void 0)},t.prototype.dragStart=function(t){var n;return n=this,t.preventDefault(),n.direction=(n.newAngle%360+360)%360,n.xVal=t.clientX,n.yVal=t.clientY,n.dragMoveContext=function(t){return n.dragMove(t)},n.dragStopContext=function(t){return n.dragStop(t)},n.canvas.addEventListener("mousemove",n.dragMoveContext,!1),n.doc.addEventListener("mouseup",n.dragStopContext,!1),n.config.callbackOnDragStart?n.config.callbackOnDragStart(n.xVal,n.yVal):void 0},t.prototype.dragMove=function(t){var n;switch(n=this,n.direction){case 0:n.imgPx=n.imgPx+=t.clientX-n.xVal,n.imgPy=n.imgPy+=t.clientY-n.yVal;break;case 90:n.imgPx=n.imgPx+=t.clientY-n.yVal,n.imgPy=n.imgPy-=t.clientX-n.xVal;break;case 180:n.imgPx=n.imgPx-=t.clientX-n.xVal,n.imgPy=n.imgPy-=t.clientY-n.yVal;break;case 270:n.imgPx=n.imgPx-=t.clientY-n.yVal,n.imgPy=n.imgPy+=t.clientX-n.xVal}return n.drawImage(),n.xVal=t.clientX,n.yVal=t.clientY,n.config.callbackOnDragMove?n.config.callbackOnDragMove(n.xVal,n.yVal):void 0},t.prototype.dragStop=function(){var t;return t=this,t.canvas.removeEventListener("mousemove",t.dragMoveContext,!1),t.doc.removeEventListener("mouseup",t.dragStopContext,!1),t.config.callbackOnDragStop?t.config.callbackOnDragStop(t.xVal,t.yVal):void 0},t.prototype.rotation=function(){var t,n;return n=this,n.animating=!0,t=n.currentAngle<n.newAngle,n.animation=setInterval(function(){return t?n.currentAngle+=2:n.currentAngle-=2,n.context.rotate(2*(t?n.toRad:-n.toRad)),n.drawImage(),n.currentAngle===n.newAngle?(clearInterval(n.animation),n.animating=!1):void 0},1)},t.prototype.dataURItoBlob=function(t){var n,e,a,i;for(n=-1!==t.split(",")[0].indexOf("base64")?atob(t.split(",")[1]):decodeURI(t.split(",")[1]),i=t.split(",")[0].split(":")[1].split(";")[0],e=new Array,a=0;a<n.length;)e[a]=n.charCodeAt(a),a++;return new Blob([new Uint8Array(e)],{type:"image/jpeg"})},t.prototype.drawImage=function(){var t;return t=this,t.context.clearRect(t.cnvClearPx,t.cnvClearPy,t.cnvClearW,t.cnvClearH),t.imgPx>=-t.cnvHalfW?t.imgPx=-t.cnvHalfW:t.imgPx<=t.cnvHalfW-t.imgW&&(t.imgPx=t.cnvHalfW-t.imgW),t.imgPy>=-t.cnvHalfH?t.imgPy=-t.cnvHalfH:t.imgPy<=t.cnvHalfH-t.imgH&&(t.imgPy=t.cnvHalfH-t.imgH),t.context.drawImage(t.picture,t.imgPx,t.imgPy,t.imgW,t.imgH)},t.prototype.saveImage=function(){var t,n;return n=this,n.animating?void 0:(t=n.canvas.toDataURL(),n.config.callbackOnSave?n.config.callbackOnSave({base64:t,blob:n.dataURItoBlob(t)}):void 0)},t}();